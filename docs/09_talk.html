<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Spatial Econometrics - 9&nbsp; Estimation of spatial autoregressive models: methods (ML, Bayesian, GMM)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./10_talk.html" rel="next">
<link href="./08_talk.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./09_talk.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Estimation of spatial autoregressive models: methods (ML, Bayesian, GMM)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Spatial Econometrics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course description</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducing Spatial Econometrics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Spatial data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Working with spatial data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Creating spatial weights objects</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Antecedents</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Economic and social research questions using spatial data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Tests of spatial autocorrelation, model specification</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Spatial autoregressive models: conditional (CAR) and simultaneous (SAR)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_talk.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Estimation of spatial autoregressive models: methods (ML, Bayesian, GMM)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">No orthogonality between regression and autoregression coefficients</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Prediction and spatial models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Eigenvectors and eigenvalues of graphs of relationships between cross-sectional observations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">And what about machine learning ?</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#maximum-likelihood-estimation" id="toc-maximum-likelihood-estimation" class="nav-link active" data-scroll-target="#maximum-likelihood-estimation"><span class="header-section-number">9.1</span> Maximum likelihood estimation</a></li>
  <li><a href="#bayesian-estimation" id="toc-bayesian-estimation" class="nav-link" data-scroll-target="#bayesian-estimation"><span class="header-section-number">9.2</span> Bayesian estimation</a></li>
  <li><a href="#generalised-method-of-moments-estimation" id="toc-generalised-method-of-moments-estimation" class="nav-link" data-scroll-target="#generalised-method-of-moments-estimation"><span class="header-section-number">9.3</span> Generalised method of moments estimation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Estimation of spatial autoregressive models: methods (ML, Bayesian, GMM)</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Spatial autoregressive models used in spatial econometrics may be estimated in a number of ways. We have already used maximum likelihood estimation, so will start there, moving on to Bayesian estimation, and completing with the generalised method of moments (GMM) estimation. Much of this section is based on <span class="citation" data-cites="bivand+piras:15">Bivand and Piras (<a href="references.html#ref-bivand+piras:15" role="doc-biblioref">2015</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(unb, <span class="at">style=</span><span class="st">"W"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatialreg)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">eigenw</span>(lw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="maximum-likelihood-estimation" class="level2" data-number="9.1">
<h2 data-number="9.1" data-anchor-id="maximum-likelihood-estimation"><span class="header-section-number">9.1</span> Maximum likelihood estimation</h2>
<p>(from <span class="citation" data-cites="bivandetal:21">Bivand, Millo, and Piras (<a href="references.html#ref-bivandetal:21" role="doc-biblioref">2021</a>)</span>)</p>
<p>The log-likelihood function for the spatial error model (SEM) is:</p>
<p><span class="math display">
\ell(\beta, \rho_{\mathrm{Err}}, \sigma^2) = - \frac{N}{2} \ln 2 \pi - \frac{N}{2} \ln \sigma^2 + \ln |{\mathbf I} - \rho_{\mathrm{Err}} {\mathbf W}| - \frac{1}{2 \sigma^2} \big[({\mathbf y} - {\mathbf X}\beta)^\top ({\mathbf I} - \rho_{\mathrm{Err}} {\mathbf W})^\top({\mathbf I} - \rho_{\mathrm{Err}} {\mathbf W}) ({\mathbf y} - {\mathbf X}\beta)\big].
</span></p>
<p><span class="math inline">\beta</span> may be concentrated out of the sum of squared errors term, for example as:</p>
<p><span class="math display">
\ell(\rho_{\mathrm{Err}}, \sigma^2) = - \frac{N}{2} \ln 2 \pi - \frac{N}{2} \ln \sigma^2 + \ln |{\mathbf I} - \rho_{\mathrm{Err}} {\mathbf W}| - \frac{1}{2 \sigma^2} \big[{\mathbf y}^\top({\mathbf I} - \rho_{\mathrm{Err}} {\mathbf W})^\top ({\mathbf I} - {\mathbf Q}_{\rho_{\mathrm{Err}}}{\mathbf Q}_{\rho_{\mathrm{Err}}}^\top) ({\mathbf I} - \rho_{\mathrm{Err}} {\mathbf W}){\mathbf y}\big]
</span></p>
<p>where <span class="math inline">{\mathbf Q}_{\rho_{\mathrm{Err}}}</span> is obtained by decomposing <span class="math inline">({\mathbf X} - \rho_{\mathrm{Err}} {\mathbf W}{\mathbf X}) = {\mathbf Q}_{\rho_{\mathrm{Err}}}{\mathbf R}_{\rho_{\mathrm{Err}}}</span>.</p>
<p>The first published versions of the eigenvalue method for finding the Jacobian <span class="citation" data-cites="ord:75">(<a href="references.html#ref-ord:75" role="doc-biblioref">Ord 1975, 121</a>)</span> is:</p>
<p><span class="math display">
\ln(|{\mathbf I} - \lambda {\mathbf W}|) = \sum_{i=1}^{N} \ln(1 - \lambda\zeta_i)
</span></p>
<p>where <span class="math inline">\zeta_i</span> are the eigenvalues of <span class="math inline">{\mathbf W}.</span></p>
<p>One specific problem addressed by Ord <span class="citation" data-cites="ord:75">(<a href="references.html#ref-ord:75" role="doc-biblioref">1975, 125</a>)</span> is that of the eigenvalues of the asymmetric row-standardised matrix <span class="math inline">{\mathbf W}</span> with underlying symmetric neighbour relations <span class="math inline">c_{ij} = c_{ji}</span>. If we write <span class="math inline">{\mathbf w} = {\mathbf C}{\mathbf 1}</span>, where <span class="math inline">{\mathbf 1}</span> is a vector of ones, we can get: <span class="math inline">{\mathbf W} = {\mathbf C}{\mathbf D}</span>, where <span class="math inline">{\mathbf D} = {\mathrm {diag}}(1/{\mathbf w})</span>; by similarity, the eigenvalues of <span class="math inline">{\mathbf W}</span> are equal to those of: <span class="math inline">{\mathbf D}^{\frac{1}{2}}{\mathbf C}{\mathbf D}^\frac{1}{2}</span>. From the very beginning in <code>spdep</code>, sparse Cholesky alternatives were available for cases in which finding the eigenvalues of a large weights matrix would be impracticable, see <span class="citation" data-cites="bivandetal:13">(<a href="references.html#ref-bivandetal:13" role="doc-biblioref">Bivand, Hauke, and Kossowski 2013</a>)</span> for further details.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>SEM_pre_maj <span class="ot">&lt;-</span> <span class="fu">errorsarlm</span>(form_pre_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig=</span>e), <span class="at">quiet=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Spatial autoregressive error model

Jacobian calculated using neighbourhood matrix eigenvalues

lambda: -0.3748541  function: -4.941735  Jacobian: -4.52514  SSE: 19.01899 
lambda: 0.1502935  function: 19.30871  Jacobian: -0.788878  SSE: 16.75685 
lambda: 0.4748525  function: 16.56229  Jacobian: -8.876868  SSE: 16.21334 
lambda: 0.246777  function: 20.19845  Jacobian: -2.188131  SSE: 16.52175 
lambda: 0.2580037  function: 20.21679  Jacobian: -2.400493  SSE: 16.49824 
lambda: 0.2639805  function: 20.21899  Jacobian: -2.517964  SSE: 16.48606 
lambda: 0.2634933  function: 20.21901  Jacobian: -2.508273  SSE: 16.48704 
lambda: 0.2634766  function: 20.21901  Jacobian: -2.507941  SSE: 16.48707 
lambda: 0.2634769  function: 20.21901  Jacobian: -2.507947  SSE: 16.48707 
lambda: 0.2613861  function: 20.21868  Jacobian: -2.466594  SSE: 16.49131 
lambda: 0.2626781  function: 20.21896  Jacobian: -2.492103  SSE: 16.48869 
lambda: 0.2631716  function: 20.219  Jacobian: -2.501885  SSE: 16.48769 
lambda: 0.2633601  function: 20.21901  Jacobian: -2.505626  SSE: 16.48731 
lambda: 0.2634321  function: 20.21901  Jacobian: -2.507056  SSE: 16.48716 
lambda: 0.2634596  function: 20.21901  Jacobian: -2.507603  SSE: 16.48711 
lambda: 0.2634701  function: 20.21901  Jacobian: -2.507812  SSE: 16.48709 
lambda: 0.2634743  function: 20.21901  Jacobian: -2.507896  SSE: 16.48708 
lambda: 0.2634758  function: 20.21901  Jacobian: -2.507924  SSE: 16.48708 
lambda: 0.2634762  function: 20.21901  Jacobian: -2.507934  SSE: 16.48707 
lambda: 0.2634766  function: 20.21901  Jacobian: -2.50794  SSE: 16.48707 
lambda: 0.2634767  function: 20.21901  Jacobian: -2.507943  SSE: 16.48707 
lambda: 0.2634766  function: 20.21901  Jacobian: -2.507941  SSE: 16.48707 
lambda: 0.2634766  function: 20.21901  Jacobian: -2.507941  SSE: 16.48707 
lambda: 0.2634766  function: 20.21901  Jacobian: -2.507941  SSE: 16.48707 </code></pre>
</div>
</div>
<p>The values used in calculating the likelihood function can be tracked as line search moves towards the optimum, where for many of the final iterations, the value of the spatial coefficient, here reported as <code>lambda</code>, moves little.</p>
<p>The log-likelihood function for the spatial lag model is:</p>
<p><span class="math display">
\ell(\beta, \rho_{\mathrm{Lag}}, \sigma^2) = - \frac{N}{2} \ln 2 \pi - \frac{N}{2} \ln \sigma^2 + \ln |{\mathbf I} - \rho_{\mathrm{Lag}} {\mathbf W}| - \frac{1}{2 \sigma^2} \big[(({\mathbf I} - \rho_{\mathrm{Lag}} {\mathbf W}){\mathbf y} - {\mathbf X}\beta)^\top(({\mathbf I} - \rho_{\mathrm{Lag}} {\mathbf W}){\mathbf y} - {\mathbf X}\beta)\big]
</span></p>
<p>and by extension the same framework is used for the spatial Durbin model when <span class="math inline">[{\mathbf X} ({\mathbf W}{\mathbf X})]</span> are grouped together. The sum-of-squared errors (SSE) term in the square brackets is found using auxilliary regressions <span class="math inline">{\mathbf e} = {\mathbf y}-({\mathbf X}^\top{\mathbf X}){\mathbf X}{\mathbf y}</span> and <span class="math inline">{\mathbf u} = {\mathbf W}{\mathbf y}-({\mathbf X}^\top{\mathbf X}){\mathbf X}{\mathbf W}{\mathbf y}</span>, and <span class="math inline">SSE = {\mathbf e}^\top{\mathbf e} - 2 \rho_{\mathrm{Lag}} {\mathbf u}^\top{\mathbf e} + \rho_{\mathrm{Lag}}^2 {\mathbf u}^\top{\mathbf u}</span>. The cross-products of <span class="math inline">{\mathbf u}</span> and <span class="math inline">{\mathbf e}</span> can conveniently be calculated before line search begins; <span class="citation" data-cites="bivand:12">Bivand (<a href="references.html#ref-bivand:12" role="doc-biblioref">2012</a>)</span> gives more details.</p>
<p>Models with two parameters require that <span class="math inline">\rho_{\mathrm{Lag}}</span> and <span class="math inline">\rho_{\mathrm{Err}}</span> be found by constrained numerical optimization in two dimensions by searching for the maximum on the surface of the log likelihood function, which is like that of the spatial error model with additional terms in <span class="math inline">{\mathbf I} - \rho_{\mathrm{Lag}} {\mathbf W}</span>:</p>
<p><span class="math display">
\ell(\rho_{\mathrm{Lag}}, \rho_{\mathrm{Err}}, \sigma^2) = - \frac{N}{2} \ln 2 \pi - \frac{N}{2} \ln \sigma^2 + \ln |{\mathbf I} - \rho_{\mathrm{Lag}} {\mathbf W}| + \ln |{\mathbf I} - \rho_{\mathrm{Err}} {\mathbf W}| - \frac{1}{2 \sigma^2} \big[{\mathbf y}^\top({\mathbf I} - \rho_{\mathrm{Lag}} {\mathbf W})^\top({\mathbf I} - \rho_{\mathrm{Err}} {\mathbf W})^\top({\mathbf I} - {\mathbf Q}_{\rho_{\mathrm{Err}}}{\mathbf Q}_{\rho_{\mathrm{Err}}}^\top) ({\mathbf I} - \rho_{\mathrm{Err}} {\mathbf W})({\mathbf I} - \rho_{\mathrm{Lag}} {\mathbf W}){\mathbf y}\big]
</span></p>
<p>where <span class="math inline">{\mathbf Q}_{\rho_{\mathrm{Err}}}</span> is obtained by decomposing <span class="math inline">({\mathbf X} - \rho_{\mathrm{Err}} {\mathbf W}{\mathbf X}) = {\mathbf Q}_{\rho_{\mathrm{Err}}} {\mathbf R}_{\rho_{\mathrm{Err}}}</span>.</p>
<p>The <code>nlminb</code> optimiser is currently used by default, but as the figure shows, it jumps around quite a lot on the flat ridge of the surface of the log-likelihood, here displayed after additional calculation over a 40 by 40 grid. Note that this work has been computed on a x86_64/amd64 processor, which uses 80-bit extended precision. We are already seeing cases of arm64 processors with 64-bit precision affecting optimisation outcomes, (Apple Silicon, expected elsewhere). Much AI/GPU technology uses reduced precision, unfortunately.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>SAC_pre_maj <span class="ot">&lt;-</span> <span class="fu">sacsarlm</span>(form_pre_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig1=</span>e, <span class="at">pre_eig2=</span>e), <span class="at">llprof=</span><span class="dv">40</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>SAC_track <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(sac <span class="ot">&lt;-</span> <span class="fu">sacsarlm</span>(form_pre_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig1=</span>e, <span class="at">pre_eig2=</span>e), <span class="at">quiet=</span><span class="cn">FALSE</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(SAC_pre_maj<span class="sc">$</span>rho, SAC_pre_maj<span class="sc">$</span>lambda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      rho    lambda 
0.1073891 0.1344878 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(SAC_pre_maj<span class="sc">$</span>rho<span class="sc">/</span>SAC_pre_maj<span class="sc">$</span>rho.se, SAC_pre_maj<span class="sc">$</span>lambda<span class="sc">/</span>SAC_pre_maj<span class="sc">$</span>lambda.se)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     rho   lambda 
1.950402 1.398422 </code></pre>
</div>
</div>
<p>The estimated spatial parameters, and their z-values show that the null hypothesis of no difference from zero may well be acceptable for both, with <span class="math inline">\rho_{\mathrm{Lag}}</span> more likely to be in play than <span class="math inline">\rho_{\mathrm{Err}}</span>; this matches the observation that the LM test for residual spatial autocorrelation from the SLM model did not reject the null hypothesis of no residual spatial autocorrelation. Here <span class="math inline">\rho_{\mathrm{Err}}</span> and <span class="math inline">\rho_{\mathrm{Lag}}</span> are competing for any remaining spatial signal in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">matrix</span>(SAC_pre_maj<span class="sc">$</span>llprof<span class="sc">$</span>ll, <span class="dv">40</span>, <span class="dv">40</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(SAC_track)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>sac_track <span class="ot">&lt;-</span> <span class="fu">read.table</span>(con, <span class="at">skip=</span><span class="dv">14</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">close</span>(con)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(SAC_pre_maj<span class="sc">$</span>llprof<span class="sc">$</span>xseq, SAC_pre_maj<span class="sc">$</span>llprof<span class="sc">$</span>yseq, m, <span class="at">levels=</span><span class="fu">quantile</span>(<span class="fu">c</span>(m), <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)), <span class="at">xlab=</span><span class="st">"rho"</span>, <span class="at">ylab=</span><span class="st">"lambda"</span>, <span class="at">col=</span><span class="st">"blue4"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span>SAC_pre_maj<span class="sc">$</span>rho, <span class="at">v=</span>SAC_pre_maj<span class="sc">$</span>lambda, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"grey"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(sac_track<span class="sc">$</span>V2, sac_track<span class="sc">$</span>V4, <span class="at">col=</span><span class="st">"brown3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="09_talk_files/figure-html/est4-1.png" width="672" class="figure-img"></p>
<figcaption>SAC pre-CCT with political control model log likelihood surface and optimiser path to optimum</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="bayesian-estimation" class="level2" data-number="9.2">
<h2 data-number="9.2" data-anchor-id="bayesian-estimation"><span class="header-section-number">9.2</span> Bayesian estimation</h2>
<p>There is no time now to go into depth about Bayesian estimation, for now it is sufficient to know that instead of fitting models using maximum likelihood by optimising the log-likelihood function, the likelihood function and the underlying distributional assumptions are sampled from in this case in a Markov chain Monte Carlo framework.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>SAC_bayes <span class="ot">&lt;-</span> <span class="fu">spBreg_sac</span>(form_pre_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">control=</span><span class="fu">list</span>(<span class="at">ndraw=</span><span class="dv">20000</span>L, <span class="at">nomit=</span><span class="dv">2000</span>L))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we are fitting a SAC model with 20,000 samples drawn, and report the outcomes for <span class="math inline">\rho_{\mathrm{Lag}}</span>, <span class="math inline">\rho_{\mathrm{Err}}</span> and <span class="math inline">\sigma^2</span> (for ML, <span class="math inline">\sigma^2</span> was 0.05087):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(SAC_bayes[, <span class="fu">c</span>(<span class="st">"rho"</span>, <span class="st">"lambda"</span>, <span class="st">"sige"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 2001:20000
Thinning interval = 1 
Number of chains = 1 
Sample size per chain = 18000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean       SD  Naive SE Time-series SE
rho    0.10663 0.062091 4.628e-04      1.639e-03
lambda 0.13046 0.114612 8.543e-04      2.934e-03
sige   0.05209 0.004221 3.146e-05      3.425e-05

2. Quantiles for each variable:

           2.5%     25%     50%     75%   97.5%
rho    -0.01906 0.06517 0.10733 0.14747 0.22475
lambda -0.09906 0.05552 0.13124 0.20869 0.34742
sige    0.04446 0.04919 0.05186 0.05476 0.06093</code></pre>
</div>
</div>
<p>The MCMC estimation methods in <code>spatialreg</code> report in <code>mcmc</code> objects defined in <code>coda</code>, and tests for convergence provided in that package can also be used. The figure shows that sampling for the spatial coefficients is somewhat uneven, which is perhaps unsurprising since they carry little information:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>)) </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(SAC_bayes[, <span class="fu">c</span>(<span class="st">"rho"</span>, <span class="st">"lambda"</span>, <span class="st">"sige"</span>)], <span class="at">smooth=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="09_talk_files/figure-html/bayes3-1.png" width="672" class="figure-img"></p>
<figcaption>Sampling traces and density plots for spatial coefficients and <span class="math inline">\sigma^2</span>, SAC model with political control, MCMC, 20,000 draws</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="generalised-method-of-moments-estimation" class="level2" data-number="9.3">
<h2 data-number="9.3" data-anchor-id="generalised-method-of-moments-estimation"><span class="header-section-number">9.3</span> Generalised method of moments estimation</h2>
<p>There are implementations of some GMM estimation methods in <code>spatialreg</code>, but those in <code>sphet</code> are actively maintained and better adapted to recent research results <span class="citation" data-cites="piras:10">(<a href="references.html#ref-piras:10" role="doc-biblioref">Piras 2010</a>)</span>. The workhorse <code>spreg</code> model fitting function can be used with several different models, including <code>"sarar"</code> also known as SAC:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sphet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'sphet'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:spatialreg':

    impacts</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>SAC_gmm <span class="ot">&lt;-</span> <span class="fu">spreg</span>(form_pre_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">model=</span><span class="st">"sarar"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">coef</span>(SAC_gmm)[<span class="fu">c</span>(<span class="st">"lambda"</span>, <span class="st">"rho"</span>),], <span class="at">s2=</span><span class="fu">as.numeric</span>(SAC_gmm<span class="sc">$</span>s2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    lambda        rho         s2 
0.18324659 0.05111413 0.05259217 </code></pre>
</div>
</div>
<p>Note that here <code>lambda</code> is <span class="math inline">\rho_{\mathrm{Lag}}</span>, and <code>rho</code> is <span class="math inline">\rho_{\mathrm{Err}}</span>, reversing the meaning of the terms elsewhere. Once again the <code>nlminb</code> optimiser is used, as in a number of steps <span class="math inline">\rho_{\mathrm{Lag}}</span> is estimated by spatial two-stage least squares using <span class="math inline">{\mathbf W}{\mathbf X}</span> and <span class="math inline">{\mathbf W}{\mathbf W}{\mathbf X}</span> as instruments, and then optimising <span class="math inline">\rho_{\mathrm{Err}}</span> and <span class="math inline">\sigma^2</span> in the method of moments steps. GMM does not use the log determinant of the Jacobian term in the model specification, and this was one of the reasons for the development of such methods.</p>
<p>More details on GMM estimation may be found in <span class="citation" data-cites="bivandetal:21">Bivand, Millo, and Piras (<a href="references.html#ref-bivandetal:21" role="doc-biblioref">2021</a>)</span> and articles cited therein, and <span class="citation" data-cites="kelejian+piras:17">Kelejian and Piras (<a href="references.html#ref-kelejian+piras:17" role="doc-biblioref">2017</a>)</span>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-bivand:12" class="csl-entry" role="listitem">
Bivand, Roger. 2012. <span>“After <span>‘<span class="nocase">Raising the Bar</span>’</span>: Applied Maximum Likelihood Estimation of Families of Models in Spatial Econometrics.”</span> <em>Estadística Española</em> 54: 71–88.
</div>
<div id="ref-bivandetal:13" class="csl-entry" role="listitem">
Bivand, Roger, Jan Hauke, and Tomasz Kossowski. 2013. <span>“Computing the <span>J</span>acobian in <span>G</span>aussian Spatial Autoregressive Models: An Illustrated Comparison of Available Methods.”</span> <em>Geographical Analysis</em> 45: 150–79.
</div>
<div id="ref-bivandetal:21" class="csl-entry" role="listitem">
Bivand, Roger, Giovanni Millo, and Gianfranco Piras. 2021. <span>“A Review of Software for Spatial Econometrics in <span>R</span>.”</span> <em>Mathematics</em> 9 (11). <a href="https://doi.org/10.3390/math9111276">https://doi.org/10.3390/math9111276</a>.
</div>
<div id="ref-bivand+piras:15" class="csl-entry" role="listitem">
Bivand, Roger, and Gianfranco Piras. 2015. <span>“Comparing Implementations of Estimation Methods for Spatial Econometrics.”</span> <em>Journal of Statistical Software</em> 63 (1): 1–36. <a href="https://doi.org/10.18637/jss.v063.i18">https://doi.org/10.18637/jss.v063.i18</a>.
</div>
<div id="ref-kelejian+piras:17" class="csl-entry" role="listitem">
Kelejian, Harry, and Gianfranco Piras. 2017. <em>Spatial Econometrics</em>. London: Academic Press.
</div>
<div id="ref-ord:75" class="csl-entry" role="listitem">
Ord, J. Keith. 1975. <span>“Estimation Methods for Models of Spatial Interaction.”</span> <em>Journal of the American Statistical Association</em> 70: 120–26.
</div>
<div id="ref-piras:10" class="csl-entry" role="listitem">
Piras, Gianfranco. 2010. <span>“Sphet: Spatial Models with Heteroskedastic Innovations in <span>R</span>.”</span> <em>Journal of Statistical Software</em> 35: 1–21.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./08_talk.html" class="pagination-link" aria-label="Spatial autoregressive models: conditional (CAR) and simultaneous (SAR)">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Spatial autoregressive models: conditional (CAR) and simultaneous (SAR)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./10_talk.html" class="pagination-link" aria-label="No orthogonality between regression and autoregression coefficients">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">No orthogonality between regression and autoregression coefficients</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Spatial Econometrics - 8&nbsp; Spatial autoregressive models: conditional (CAR) and simultaneous (SAR)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./09_talk.html" rel="next">
<link href="./07_talk.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./08_talk.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Spatial autoregressive models: conditional (CAR) and simultaneous (SAR)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Spatial Econometrics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course description</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducing Spatial Econometrics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Spatial data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Working with spatial data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Creating spatial weights objects</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Antecedents</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Economic and social research questions using spatial data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Tests of spatial autocorrelation, model specification</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_talk.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Spatial autoregressive models: conditional (CAR) and simultaneous (SAR)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Estimation of spatial autoregressive models: methods (ML, Bayesian, GMM)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">No orthogonality between regression and autoregression coefficients</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Prediction and spatial models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Eigenvectors and eigenvalues of graphs of relationships between cross-sectional observations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_talk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">And what about machine learning ?</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#car-and-sar" id="toc-car-and-sar" class="nav-link active" data-scroll-target="#car-and-sar"><span class="header-section-number">8.1</span> CAR and SAR</a></li>
  <li><a href="#some-car-examples-with-english-garbage-data" id="toc-some-car-examples-with-english-garbage-data" class="nav-link" data-scroll-target="#some-car-examples-with-english-garbage-data"><span class="header-section-number">8.2</span> Some CAR examples with English garbage data</a></li>
  <li><a href="#simultaneous-autoregressive-models" id="toc-simultaneous-autoregressive-models" class="nav-link" data-scroll-target="#simultaneous-autoregressive-models"><span class="header-section-number">8.3</span> Simultaneous autoregressive models</a></li>
  <li><a href="#spatial-econometrics-models-pre-cct-examples" id="toc-spatial-econometrics-models-pre-cct-examples" class="nav-link" data-scroll-target="#spatial-econometrics-models-pre-cct-examples"><span class="header-section-number">8.4</span> Spatial econometrics models: pre-CCT examples</a></li>
  <li><a href="#spatial-econometrics-models-pre-cct-examples-including-political-control" id="toc-spatial-econometrics-models-pre-cct-examples-including-political-control" class="nav-link" data-scroll-target="#spatial-econometrics-models-pre-cct-examples-including-political-control"><span class="header-section-number">8.5</span> Spatial econometrics models: pre-CCT examples including political control</a></li>
  <li><a href="#spatial-econometrics-models-post-cct-examples-including-political-control" id="toc-spatial-econometrics-models-post-cct-examples-including-political-control" class="nav-link" data-scroll-target="#spatial-econometrics-models-post-cct-examples-including-political-control"><span class="header-section-number">8.6</span> Spatial econometrics models: post-CCT examples including political control</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Spatial autoregressive models: conditional (CAR) and simultaneous (SAR)</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="car-and-sar" class="level2" data-number="8.1">
<h2 data-number="8.1" data-anchor-id="car-and-sar"><span class="header-section-number">8.1</span> CAR and SAR</h2>
<p>(from: <span class="citation" data-cites="pebesma+bivand:23">Pebesma and Bivand (<a href="references.html#ref-pebesma+bivand:23" role="doc-biblioref">2023</a>)</span>, pp.&nbsp;233-234)</p>
<p>There is a large literature in disease mapping using conditional autoregressive (CAR) and intrinsic CAR (ICAR) models in spatially structured random effects. These extend to multilevel models, in which the spatially structured random effects may apply at different levels of the model <span class="citation" data-cites="bivandetal:17">(<a href="references.html#ref-bivandetal:17" role="doc-biblioref">Bivand et al. 2017</a>)</span>. In order to try out some of the variants, we need to remove the no-neighbour observations from the tract level, and from the model output zone aggregated level, in two steps as reducing the tract level induces a no-neighbour outcome at the model output zone level. Many of the model estimating functions take <code>family</code> arguments, and fit generalised linear mixed effects models with per-observation spatial random effects structured using a Markov random field representation of relationships between neighbours. In the multilevel case, the random effects may be modelled at the group level, which is the case presented in the following examples.</p>
<p>We follow <span class="citation" data-cites="vgr_clubuc3m:19">Gómez-Rubio (<a href="references.html#ref-vgr_clubuc3m:19" role="doc-biblioref">2019</a>)</span> in summarising <span class="citation" data-cites="R:Pinheiro+Bates:2000">Pinheiro and Bates (<a href="references.html#ref-R:Pinheiro+Bates:2000" role="doc-biblioref">2000</a>)</span> and <span class="citation" data-cites="mcculloch+searle:2001">McCulloch and Searle (<a href="references.html#ref-mcculloch+searle:2001" role="doc-biblioref">2001</a>)</span> to describe the mixed-effects model representation of spatial regression models. In a Gaussian linear mixed model setting, a random effect <span class="math inline">u</span> is added to the model, with response <span class="math inline">Y</span>, fixed covariates <span class="math inline">X</span>, their coefficients <span class="math inline">\beta</span> and error term <span class="math inline">\varepsilon_i \sim N(0, \sigma^2), i=1,\dots, n</span>:</p>
<p><span class="math display">
Y = X \beta + Z u + \varepsilon
</span></p>
<p><span class="math inline">Z</span> is a fixed design matrix for the random effects. If there are <span class="math inline">n</span> random effects, it will be an <span class="math inline">n \times n</span> identity matrix if instead the observations are aggregated into <span class="math inline">m</span> groups, so with <span class="math inline">m &lt; n</span> random effects, it will be an <span class="math inline">n \times m</span> matrix showing which group each observation belongs to. The random effects are modelled as a multivariate Normal distribution <span class="math inline">u \sim N(0, \sigma^2_u \Sigma)</span>, and <span class="math inline">\sigma^2_u \Sigma</span> is the square variance-covariance matrix of the random effects.</p>
<p>A division has grown up, possibly unhelpfully, between scientific fields using CAR models <span class="citation" data-cites="besag:74">(<a href="references.html#ref-besag:74" role="doc-biblioref">Besag 1974</a>)</span>, and simultaneous autoregressive models (SAR) <span class="citation" data-cites="ord:75 hepple:76">(<a href="references.html#ref-ord:75" role="doc-biblioref">Ord 1975</a>; <a href="references.html#ref-hepple:76" role="doc-biblioref">Hepple 1976</a>)</span>. Although CAR and SAR models are closely related, these fields have found it difficult to share experience of applying similar models, often despite referring to key work summarising the models <span class="citation" data-cites="ripley:81 ripley:88 cressie:93">(<a href="references.html#ref-ripley:81" role="doc-biblioref">Ripley 1981</a>, <a href="references.html#ref-ripley:88" role="doc-biblioref">1988</a>; <a href="references.html#ref-cressie:93" role="doc-biblioref">Cressie 1993</a>)</span>. Ripley gives the SAR variance as <span class="citation" data-cites="ripley:81">(<a href="references.html#ref-ripley:81" role="doc-biblioref">Ripley 1981, 89</a>)</span>, here shown as the inverse <span class="math inline">\Sigma^{-1}</span> (also known as the precision matrix):</p>
<p><span class="math display">
\Sigma^{-1} = [(I - \rho W)^\top(I - \rho W)]
</span></p>
<p>where <span class="math inline">\rho</span> is a spatial autocorrelation parameter and <span class="math inline">W</span> is a non-singular spatial weights matrix that represents spatial dependence. The CAR variance is:</p>
<p><span class="math display">
\Sigma^{-1} = (I - \rho W)
</span></p>
<p>where <span class="math inline">W</span> is a symmetric and strictly positive definite spatial weights matrix. In the case of the intrinsic CAR model, avoiding the estimation of a spatial autocorrelation parameter, we have:</p>
<p><span class="math display">
\Sigma^{-1} = M = \mathrm{diag}(n_i) - W
</span></p>
<p>where <span class="math inline">W</span> is a symmetric and strictly positive definite spatial weights matrix as before and <span class="math inline">n_i</span> are the row sums of <span class="math inline">W</span>. The Besag-York-Mollié model includes intrinsic CAR spatially structured random effects and unstructured random effects. The Leroux model combines matrix components for unstructured and spatially structured random effects, where the spatially structured random effects are taken as following an intrinsic CAR specification:</p>
<p><span class="math display">
\Sigma^{-1} = [(1 - \rho) I_n + \rho M]
</span></p>
<p>References to the definitions of these models may be found in <span class="citation" data-cites="gómez2020bayesian">Gómez-Rubio (<a href="references.html#ref-gómez2020bayesian" role="doc-biblioref">2020</a>)</span>, and estimation issues affecting the Besag-York-Mollié and Leroux models are reviewed by <span class="citation" data-cites="JSSv063c01">Gerber and Furrer (<a href="references.html#ref-JSSv063c01" role="doc-biblioref">2015</a>)</span>.</p>
<p>More recent books expounding the theoretical bases for modelling with areal data simply point out the similarities between SAR and CAR models in relevant chapters <span class="citation" data-cites="gaetan+guyon:10 vanlieshout:19">(<a href="references.html#ref-gaetan+guyon:10" role="doc-biblioref">Gaetan and Guyon 2010</a>; <a href="references.html#ref-vanlieshout:19" role="doc-biblioref">Lieshout 2019</a>)</span>; the interested reader is invited to consult these sources for background information.</p>
</section>
<section id="some-car-examples-with-english-garbage-data" class="level2" data-number="8.2">
<h2 data-number="8.2" data-anchor-id="some-car-examples-with-english-garbage-data"><span class="header-section-number">8.2</span> Some CAR examples with English garbage data</h2>
<p>In spatial econometrics, CAR is not used, nor are binary spatial weights; they both are, however, extensively used in spatial epidemiology (disease mapping). The CAR model accounts for spatial autocorrelation in the residuals of a linear model by modelling that residual dependency in various ways. <code>spatialreg</code> provides <code>spautolm</code> using Maximum Likelihood (ML) including a <code>"CAR"</code> family member, but does not have a direct method for extracting the spatially structured random effect (SSRE) from the fitted model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>lwB <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(unb, <span class="at">style=</span><span class="st">"B"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatialreg)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>car1 <span class="ot">&lt;-</span> <span class="fu">spautolm</span>(form_pre, <span class="at">data=</span>eng324, <span class="at">listw=</span>lwB, <span class="at">family=</span><span class="st">"CAR"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(car1, <span class="at">Nagelkerke=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call: spautolm(formula = form_pre, data = eng324, listw = lwB, family = "CAR")

Residuals:
       Min         1Q     Median         3Q        Max 
-1.2458705 -0.1271315 -0.0082244  0.1395717  0.9975448 

Coefficients: 
                 Estimate Std. Error z value  Pr(&gt;|z|)
(Intercept)    -5.2940330  1.4601452 -3.6257 0.0002882
log(units)      0.9890709  0.0374943 26.3793 &lt; 2.2e-16
house          -1.7376836  0.3188845 -5.4493 5.058e-08
log(dens)       0.0032286  0.0129677  0.2490 0.8033847
Metroplondon    0.1181653  0.0765654  1.5433 0.1227517
Metropmetrop    0.0032977  0.0648167  0.0509 0.9594235
log(realWgPre)  0.5710435  0.2692001  2.1213 0.0338999

Lambda: 0.12806 LR test value: 20.119 p-value: 7.2757e-06 
Numerical Hessian standard error of lambda: 0.01965 

Log likelihood: 10.54415 
ML residual variance (sigma squared): 0.051948, (sigma: 0.22792)
Number of observations: 324 
Number of parameters estimated: 9 
AIC: -3.0883
Nagelkerke pseudo-R-squared: 0.84639 </code></pre>
</div>
</div>
<p><span class="citation" data-cites="cressie:93">Cressie (<a href="references.html#ref-cressie:93" role="doc-biblioref">1993</a>)</span> gives the spatial component of the fit as <span class="math inline">\rho_{\mathrm{Err}} {\mathbf W} ({\mathbf y} - {\mathbf X}{\mathbf \beta})</span> (p.&nbsp;564, eq. 7.6.31):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>eng324<span class="sc">$</span>ranef_ml <span class="ot">&lt;-</span> car1<span class="sc">$</span>fit<span class="sc">$</span>signal_stochastic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hierarchical GLM <code>hglm</code> <span class="citation" data-cites="alam-ronnegard-shen:2015">(<a href="references.html#ref-alam-ronnegard-shen:2015" role="doc-biblioref">Alam, Rönnegård, and Shen 2015</a>)</span> can be used for fitting a proper CAR model as a <code>rand.family</code> argument passing in the binary spatial weights coerced into a symmetric sparse matrix:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hglm)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">as</span>(lwB, <span class="st">"CsparseMatrix"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>car2 <span class="ot">&lt;-</span> <span class="fu">hglm</span>(<span class="at">fixed=</span>form_pre, <span class="at">random=</span> <span class="sc">~</span> <span class="dv">1</span><span class="sc">|</span>ID, <span class="at">data=</span>eng324, <span class="at">family =</span> <span class="fu">gaussian</span>(), <span class="at">rand.family=</span><span class="fu">CAR</span>(<span class="at">D=</span>W))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>car2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: 
hglm.formula(family = gaussian(), rand.family = CAR(D = W), fixed = form_pre, 
    random = ~1 | ID, data = eng324)

---------------------------
Estimates of the mean model
---------------------------

Fixed effects:
   (Intercept)     log(units)          house      log(dens)   Metroplondon 
  -5.256205728    0.982604641   -1.740287615    0.006107953    0.109398222 
  Metropmetrop log(realWgPre) 
   0.015926892    0.572707449 

Random effects:
[1]  0.07512008 -0.01960200  0.14569011
...
[1] 0.11309920 0.05048601
NOTE: to show all the random effects estimates, use print(hglm.object, print.ranef = TRUE).

Dispersion parameter for the mean model: 0.03210403 

Dispersion parameter for the random effects: 3.83044e+21 

Estimation did not converge in 3 iterations

!! Observation 65 is too influential! Estimates are likely unreliable !!</code></pre>
</div>
</div>
<p>The fitting algorithm does not converge, so no estimate of the spatial autoregressive parameter is returned; a warning is given that one observation is highly unusual:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.character</span>(eng324<span class="sc">$</span>NAME[<span class="dv">65</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "CITY OF LONDON"</code></pre>
</div>
</div>
<p>As almost nobody lives there, the proportion of houses in pick-up points is only 0.21, far below the median of 0.93; other variables are less extreme. No provision is made for dropping the outlier, so we will keep it; the SSRE is provided:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>eng324<span class="sc">$</span>ranef_hglm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">unname</span>(car2<span class="sc">$</span>ranef))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, an intrinsic CAR (here termed Markov Random Field, MRF) can be fitted with <code>mgcv</code> using <code>gam</code> with an <code>"mrf"</code> smooth, and a spatial neighbour object with names set on the object components to match the variable defining the random effects:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: nlme</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is mgcv 1.9-1. For overview type 'help("mgcv-package")'.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(unb) <span class="ot">&lt;-</span> <span class="fu">attr</span>(unb, <span class="st">"region.id"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>eng324<span class="sc">$</span>NAME <span class="ot">&lt;-</span> <span class="fu">factor</span>(eng324<span class="sc">$</span>NAME)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>car3 <span class="ot">&lt;-</span> <span class="fu">gam</span>(<span class="fu">update</span>(form_pre, . <span class="sc">~</span> . <span class="sc">+</span> <span class="fu">s</span>(NAME, <span class="at">bs=</span><span class="st">"mrf"</span>, <span class="at">xt=</span><span class="fu">list</span>(<span class="at">nb=</span>unb))), <span class="at">data=</span>eng324)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(car3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Family: gaussian 
Link function: identity 

Formula:
log(realNetPre) ~ log(units) + house + log(dens) + Metrop + log(realWgPre) + 
    s(NAME, bs = "mrf", xt = list(nb = unb))

Parametric coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    -4.579478   1.778786  -2.574   0.0108 *  
log(units)      1.029406   0.037874  27.180  &lt; 2e-16 ***
house          -1.916974   0.325147  -5.896 1.71e-08 ***
log(dens)      -0.005621   0.012749  -0.441   0.6598    
Metroplondon   -0.018417   0.089088  -0.207   0.8365    
Metropmetrop   -0.121942   0.068941  -1.769   0.0786 .  
log(realWgPre)  0.403762   0.327662   1.232   0.2194    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Approximate significance of smooth terms:
        edf Ref.df     F p-value    
s(NAME) 130    319 1.057  &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-sq.(adj) =  0.918   Deviance explained = 95.2%
GCV = 0.051034  Scale est. = 0.029448  n = 324</code></pre>
</div>
</div>
<p>SSRE are not returned directly, but can be extracted from predictions for the data used to fit the model, taking only the smooth term:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>eng324<span class="sc">$</span>ranef_mrf <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">predict</span>(car3, <span class="at">type=</span><span class="st">"terms"</span>)[, <span class="st">"s(NAME)"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can tabulate the fixed effects coefficients, and see that these fitting approaches yield similar but not identical values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">ML=</span><span class="fu">coef</span>(car1), <span class="at">HGLM=</span><span class="fu">c</span>(car2<span class="sc">$</span>fixef, <span class="cn">NA</span>), <span class="at">MRF=</span><span class="fu">c</span>(<span class="fu">coef</span>(car3)[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>], <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         ML         HGLM          MRF
(Intercept)    -5.294032977 -5.256205728 -4.579477921
log(units)      0.989070893  0.982604641  1.029405939
house          -1.737683649 -1.740287615 -1.916973856
log(dens)       0.003228567  0.006107953 -0.005621393
Metroplondon    0.118165294  0.109398222 -0.018416579
Metropmetrop    0.003297685  0.015926892 -0.121942154
log(realWgPre)  0.571043491  0.572707449  0.403761668
lambda          0.128061085           NA           NA</code></pre>
</div>
</div>
<p>We can also look at correlations between the three approximations to SSRE:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(<span class="fu">st_drop_geometry</span>(eng324)[, <span class="fu">c</span>(<span class="st">"ranef_ml"</span>, <span class="st">"ranef_hglm"</span>, <span class="st">"ranef_mrf"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            ranef_ml ranef_hglm ranef_mrf
ranef_ml   1.0000000  0.6203440 0.6620203
ranef_hglm 0.6203440  1.0000000 0.9297771
ranef_mrf  0.6620203  0.9297771 1.0000000</code></pre>
</div>
</div>
<p>It is characteristic of work in disease mapping that the SSRE are mapped, and the maps are interpreted to learn whether the data collection could have been improved. It is not usual that work in spatial econometrics includes maps, and this difference has been noted critically by spatial statisticians. Here are comparative maps of the three output sets of SSRE:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Breaking News: tmap 3.x is retiring. Please test v4, e.g. with
remotes::install_github('r-tmap/tmap')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(eng324) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="fu">c</span>(<span class="st">"ranef_ml"</span>, <span class="st">"ranef_hglm"</span>, <span class="st">"ranef_mrf"</span>), <span class="at">title=</span><span class="st">"random effect"</span>, <span class="at">n=</span><span class="dv">9</span>, <span class="at">midpoint=</span><span class="dv">0</span>, <span class="at">style=</span><span class="st">"fisher"</span>) <span class="sc">+</span> <span class="fu">tm_borders</span>() <span class="sc">+</span> <span class="fu">tm_facets</span>(<span class="at">free.scales=</span><span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">panel.labels=</span><span class="fu">c</span>(<span class="st">"ML"</span>, <span class="st">"HGLM"</span>, <span class="st">"MRF"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="08_talk_files/figure-html/ranef_vis0-1.png" width="672" class="figure-img"></p>
<figcaption>Maps of spatially structured random effects, conditional autoregressive models</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="simultaneous-autoregressive-models" class="level2" data-number="8.3">
<h2 data-number="8.3" data-anchor-id="simultaneous-autoregressive-models"><span class="header-section-number">8.3</span> Simultaneous autoregressive models</h2>
<p>There are many varieties of model fitting methods for CAR models, fewer for SAR. We can begin by using <code>spautolm</code> using Maximum Likelihood (ML) again, choosing SAR rather than CAR, but initially retaining the binary spatial weights:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>sar1B <span class="ot">&lt;-</span> <span class="fu">spautolm</span>(form_pre, <span class="at">data=</span>eng324, <span class="at">listw=</span>lwB, <span class="at">family=</span><span class="st">"SAR"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sar1B, <span class="at">Nagelkerke=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call: spautolm(formula = form_pre, data = eng324, listw = lwB, family = "SAR")

Residuals:
       Min         1Q     Median         3Q        Max 
-1.1973371 -0.1330977  0.0042846  0.1472354  1.0226467 

Coefficients: 
                 Estimate Std. Error z value  Pr(&gt;|z|)
(Intercept)    -5.2182355  1.4520462 -3.5937  0.000326
log(units)      0.9881039  0.0375060 26.3452 &lt; 2.2e-16
house          -1.7196249  0.3196133 -5.3803 7.435e-08
log(dens)       0.0029204  0.0129370  0.2257  0.821401
Metroplondon    0.1254203  0.0767156  1.6349  0.102076
Metropmetrop    0.0093832  0.0648807  0.1446  0.885009
log(realWgPre)  0.5562152  0.2681111  2.0746  0.038026

Lambda: 0.073558 LR test value: 19.892 p-value: 8.1948e-06 
Numerical Hessian standard error of lambda: 0.015158 

Log likelihood: 10.4304 
ML residual variance (sigma squared): 0.053275, (sigma: 0.23081)
Number of observations: 324 
Number of parameters estimated: 9 
AIC: -2.8608
Nagelkerke pseudo-R-squared: 0.84628 </code></pre>
</div>
</div>
<p>As row-standardised weights are much more common in spatial econometrics, let us switch (back) to them. First we see that the domain of the spatial coefficient depends on the spatial weights, and is the inverse of the range of the eigenvalues of the spatial weights matrix; this applies irrespective of the estimation method:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="fu">range</span>(<span class="fu">eigenw</span>(lwB))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.3129207  0.1666602</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(unb, <span class="at">style=</span><span class="st">"W"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">eigenw</span>(lw)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="fu">range</span>(e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.224561  1.000000</code></pre>
</div>
</div>
<p>The value of the single spatial parameter is found by line search (univariate optimisation). In <code>spautolm</code>, the objective function includes the use of numerical inversion of the <span class="math inline">{\mathbf X}^\top{\mathbf A}{\mathbf X}</span> matrix, where in the CAR case, <span class="math inline">{\mathbf A} = {\mathbf I} - \rho{\mathbf W}</span>, but in the SAR case, it is <span class="math inline">{\mathbf A} = ({\mathbf I} - \rho{\mathbf W})^\top({\mathbf I} - \rho{\mathbf W})</span>, using plug-in functions. Using <code>spautolm</code>, we get:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>sar1 <span class="ot">&lt;-</span> <span class="fu">spautolm</span>(form_pre, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">family=</span><span class="st">"SAR"</span>, <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig=</span>e))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sar1, <span class="at">Nagelkerke=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call: spautolm(formula = form_pre, data = eng324, listw = lw, family = "SAR", 
    control = list(pre_eig = e))

Residuals:
       Min         1Q     Median         3Q        Max 
-1.2099474 -0.1382060 -0.0061752  0.1467393  1.0037329 

Coefficients: 
                  Estimate  Std. Error z value  Pr(&gt;|z|)
(Intercept)    -4.99283719  1.49150170 -3.3475 0.0008154
log(units)      0.99637181  0.03760832 26.4934 &lt; 2.2e-16
house          -1.73716260  0.31817206 -5.4598 4.766e-08
log(dens)       0.00052967  0.01256022  0.0422 0.9663626
Metroplondon    0.10864174  0.07912775  1.3730 0.1697549
Metropmetrop   -0.00633204  0.06608941 -0.0958 0.9236713
log(realWgPre)  0.50480257  0.27573061  1.8308 0.0671331

Lambda: 0.35401 LR test value: 19.988 p-value: 7.7912e-06 
Numerical Hessian standard error of lambda: 0.072223 

Log likelihood: 10.47868 
ML residual variance (sigma squared): 0.05332, (sigma: 0.23091)
Number of observations: 324 
Number of parameters estimated: 9 
AIC: -2.9574
Nagelkerke pseudo-R-squared: 0.84632 </code></pre>
</div>
</div>
<p><code>spautolm</code> outputs the standard error of the spatial coefficient based on the numerical Hessian to estimate the information matrix of the model. <code>errorsarlm</code> was written before <code>spautolm</code>, and yields very similar values, using for moderate <span class="math inline">n</span> as in this case asymptotic standard errors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>SEM_pre <span class="ot">&lt;-</span> <span class="fu">errorsarlm</span>(form_pre, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig=</span>e))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(SEM_pre, <span class="at">Nagelkerke=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
errorsarlm(formula = form_pre, data = eng324, listw = lw, control = list(pre_eig = e))

Residuals:
       Min         1Q     Median         3Q        Max 
-1.2099474 -0.1382060 -0.0061752  0.1467393  1.0037330 

Type: error 
Coefficients: (asymptotic standard errors) 
                  Estimate  Std. Error z value  Pr(&gt;|z|)
(Intercept)    -4.99283675  1.49150136 -3.3475 0.0008154
log(units)      0.99637177  0.03760832 26.4934 &lt; 2.2e-16
house          -1.73716251  0.31817207 -5.4598 4.766e-08
log(dens)       0.00052969  0.01256022  0.0422 0.9663618
Metroplondon    0.10864178  0.07912773  1.3730 0.1697547
Metropmetrop   -0.00633193  0.06608941 -0.0958 0.9236726
log(realWgPre)  0.50480253  0.27573055  1.8308 0.0671331

Lambda: 0.35401, LR test value: 19.988, p-value: 7.7912e-06
Asymptotic standard error: 0.069512
    z-value: 5.0928, p-value: 3.5288e-07
Wald statistic: 25.936, p-value: 3.5288e-07

Log likelihood: 10.47868 for error model
ML residual variance (sigma squared): 0.05332, (sigma: 0.23091)
Nagelkerke pseudo-R-squared: 0.84632 
Number of observations: 324 
Number of parameters estimated: 9 
AIC: -2.9574, (AIC for lm: 15.031)</code></pre>
</div>
</div>
<p>It avoids some loss of numerical precision in calculation of the objective function, so the coefficients are equal after moderate rounding:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">coef</span>(SEM_pre)[<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">1</span>)], <span class="fu">coef</span>(sar1), <span class="at">tol=</span><span class="fl">2e-07</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>In addition, output from <code>errorsarlm</code> offers the Hausman test <span class="citation" data-cites="pace+lesage:08">(<a href="references.html#ref-pace+lesage:08" role="doc-biblioref">Pace and LeSage 2008</a>)</span>; the SEM and OLS regression coefficients should be close to each other and significant divergence indicates model mis-specification; it seems difficult here to accept the null hypothesis of no difference:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Hausman.test</span>(SEM_pre)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spatial Hausman test (asymptotic)

data:  NULL
Hausman test = 21.049, df = 7, p-value = 0.003699</code></pre>
</div>
</div>
</section>
<section id="spatial-econometrics-models-pre-cct-examples" class="level2" data-number="8.4">
<h2 data-number="8.4" data-anchor-id="spatial-econometrics-models-pre-cct-examples"><span class="header-section-number">8.4</span> Spatial econometrics models: pre-CCT examples</h2>
<p>We have already fitted the SEM model using ML to the basic pre-CCT formula, partly based on our initial results, indicating that SEM was to be preferred to SLM, but without considering the inclusion of <span class="math inline">{\mathbf W}{\mathbf X}</span>.</p>
<p>Use of Rao’s score tests only involve the fitting of least squares models, both OLS and SLX, but it is also possible to work back from the most complex model GNM, recalling its identification issues (using ML):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>GNM_pre <span class="ot">&lt;-</span> <span class="fu">sacsarlm</span>(form_pre, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">Durbin=</span><span class="fu">update</span>(form_pre, <span class="sc">~</span> . <span class="sc">-</span> Metrop), <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig1=</span>e, <span class="at">pre_eig2=</span>e))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>SAC_pre <span class="ot">&lt;-</span> <span class="fu">sacsarlm</span>(form_pre, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig1=</span>e, <span class="at">pre_eig2=</span>e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, since GNM includes <span class="math inline">\rho_{\mathrm{Lag}} {\mathbf W}{\mathbf y}</span>, presenting the conventional table of coefficient estimates is not appropriate, so we’ll stay with likelihood ratio tests, which depend on the models being compared being nested, and returning log-likelihood values:</p>
<p><span class="math display">
\mathrm{LR} = -2 (\ell(\theta_0) - \ell(\theta_1))
</span></p>
<p>where <span class="math inline">\ell(\theta_0)</span> is the log-likelihood of the nested model, and <span class="math inline">\ell(\theta_1)</span> of the encompassing model, and where the number of degrees of freedom for <span class="math inline">\chi^2</span> is the difference in the estimated parameter counts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: zoo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(GNM_pre, SAC_pre)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: log(realNetPre) ~ log(units) + house + log(dens) + Metrop + log(realWgPre)
Model 2: log(realNetPre) ~ log(units) + house + log(dens) + Metrop + log(realWgPre)
  #Df LogLik Df  Chisq Pr(&gt;Chisq)  
1  14 17.361                       
2  10 10.887 -4 12.947    0.01154 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>This test indicates that including <span class="math inline">{\mathbf W}{\mathbf X}</span> to the SAC model to give an GNM model only yields a minor improvement in fit. Moving on, we fit the remaining models:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>SDEM_pre <span class="ot">&lt;-</span> <span class="fu">errorsarlm</span>(form_pre, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">Durbin=</span><span class="fu">update</span>(form_pre, <span class="sc">~</span> . <span class="sc">-</span> Metrop), <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig=</span>e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Hausman.test</span>(SDEM_pre)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spatial Hausman test (asymptotic)

data:  NULL
Hausman test = 19.012, df = 11, p-value = 0.06087</code></pre>
</div>
</div>
<p>The Hausman test is now borderline, so the coefficients of the SDEM may be taken as close to those of the SLX model. Moving on:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>SDM_pre <span class="ot">&lt;-</span> <span class="fu">lagsarlm</span>(form_pre, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">Durbin=</span><span class="fu">update</span>(form_pre, <span class="sc">~</span> . <span class="sc">-</span> Metrop), <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig=</span>e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">LM_test=</span><span class="fu">signif</span>(SDM_pre<span class="sc">$</span>LMtest), <span class="at">p.value=</span><span class="fu">format.pval</span>((<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(SDM_pre<span class="sc">$</span>LMtest, <span class="dv">1</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    LM_test     p.value 
  "8.61387" "0.0033361" </code></pre>
</div>
</div>
<p>The Rao’s score (Lagrange Multiplier) test <span class="citation" data-cites="anselin:88a">(<a href="references.html#ref-anselin:88a" role="doc-biblioref">Anselin 1988</a>)</span> for residual spatial autocorrelation in the SDM model shows that the model is mis-specified.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>SLM_pre <span class="ot">&lt;-</span> <span class="fu">lagsarlm</span>(form_pre, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig=</span>e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">LM_test=</span><span class="fu">signif</span>(SLM_pre<span class="sc">$</span>LMtest), <span class="at">p.value=</span><span class="fu">format.pval</span>((<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(SLM_pre<span class="sc">$</span>LMtest, <span class="dv">1</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   LM_test    p.value 
  "6.3742" "0.011579" </code></pre>
</div>
</div>
<p>The LM test for residual spatial autocorrelation in the SLM model indicates that something in the <span class="math inline">{\mathbf W}{\mathbf X}</span> is adding spatial autocorrelation to the residuals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>SLX_pre <span class="ot">&lt;-</span> <span class="fu">lmSLX</span>(form_pre, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">Durbin=</span><span class="fu">update</span>(form_pre, <span class="sc">~</span> . <span class="sc">-</span> Metrop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>OLS_pre <span class="ot">&lt;-</span> <span class="fu">lm</span>(form_pre, <span class="at">data=</span>eng324)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>we now have eight fitted pre-CCT models, and can calculate the likelihood ratio tests between nested models. GNM nests all models, SAC nests SEM, SLM and OLS, SDEM nests SEM, SLX and OLS, SDM nests SLM, SLX and OLS (and SEM through the Common Factor <span class="math inline">\rho_{\mathrm{Err}} = - \rho_{\mathrm{Lag}}{\mathbf \beta}</span>), and SEM, SLX and SLM nest OLS:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>mlist_pre <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">GNM=</span>GNM_pre, <span class="at">SAC=</span>SAC_pre, <span class="at">SDEM=</span>SDEM_pre, <span class="at">SDM=</span>SDM_pre, <span class="at">SLX=</span>SLX_pre, <span class="at">SEM=</span>SEM_pre, <span class="at">SLM=</span>SLM_pre, <span class="at">OLS=</span>OLS_pre)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">length</span>(mlist_pre)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>LR_pre <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">ncol=</span>m, <span class="at">nrow=</span>m)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(LR_pre) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(LR_pre) <span class="ot">&lt;-</span> <span class="fu">names</span>(mlist_pre)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>m) LR_pre[<span class="dv">1</span>, j] <span class="ot">&lt;-</span> <span class="fu">lrtest</span>(mlist_pre[[<span class="dv">1</span>]],</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    mlist_pre[[j]])[[<span class="dv">2</span>, <span class="st">"Pr(&gt;Chisq)"</span>]]</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>) LR_pre[<span class="dv">2</span>, j] <span class="ot">&lt;-</span> <span class="fu">lrtest</span>(mlist_pre[[<span class="dv">2</span>]],</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    mlist_pre[[j]])[[<span class="dv">2</span>, <span class="st">"Pr(&gt;Chisq)"</span>]]</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">8</span>)) LR_pre[<span class="dv">3</span>, j] <span class="ot">&lt;-</span> <span class="fu">lrtest</span>(mlist_pre[[<span class="dv">3</span>]],</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    mlist_pre[[j]])[[<span class="dv">2</span>, <span class="st">"Pr(&gt;Chisq)"</span>]]</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>)) LR_pre[<span class="dv">4</span>, j] <span class="ot">&lt;-</span> <span class="fu">lrtest</span>(mlist_pre[[<span class="dv">4</span>]],</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    mlist_pre[[j]])[[<span class="dv">2</span>, <span class="st">"Pr(&gt;Chisq)"</span>]]</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>) LR_pre[i, <span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="fu">lrtest</span>(mlist_pre[[i]],</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    mlist_pre[[<span class="dv">8</span>]])[[<span class="dv">2</span>, <span class="st">"Pr(&gt;Chisq)"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plot.matrix)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: viridisLite</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="fl">3.1</span>, <span class="fl">3.1</span>, <span class="fl">3.1</span>, <span class="fl">7.1</span>), <span class="at">cex.axis=</span><span class="fl">0.8</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(LR_pre, <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span><span class="sc">^-</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">0</span>)), <span class="at">col=</span>viridis, <span class="at">las=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="08_talk_files/figure-html/LR3_pre-1.png" style="width:75.0%" class="figure-img"></p>
<figcaption>Heat map of likelihood ratio p-values, pre_CCT models</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The figure shows that the only comparisons indicating minor improvement in fit by making the model more complex are from SEM to SDEM or SAC; it is not clear that adding the <span class="math inline">{\mathbf W}{\mathbf X}</span> helps. In addition, the likelihood ratio does not penalise for the increased number of fitted paramters, unlike AIC and BIC, which penalise in increasing degree. The Akaike information criterion (AIC) is, where <span class="math inline">k</span> is the parameter count:</p>
<p><span class="math display">
\mathrm{AIC} = 2 k - 2 \ell(\theta)
</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">sapply</span>(mlist_pre, AIC))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      GNM       SEM       SDM       SAC      SDEM       SLM       SLX       OLS 
-6.722113 -2.957365 -2.742996 -1.774990 -1.102252  3.887504 13.872713 15.031060 </code></pre>
</div>
</div>
<p>The BIC scores put all of the models including <span class="math inline">{\mathbf W}{\mathbf X}</span> behind those without, pointing to SEM, followed by SAC and SLM. The Bayesian information criterion (BIC) is, for n, the observation count:</p>
<p><span class="math display">
\mathrm{BIC} = k \ln(n) - 2 \ell(\theta)
</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">sapply</span>(mlist_pre, BIC))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     SEM      SAC      SLM      OLS      GNM      SDM     SDEM      SLX 
31.06933 36.03245 37.91420 45.27701 46.20830 46.40667 48.04741 59.24163 </code></pre>
</div>
</div>
</section>
<section id="spatial-econometrics-models-pre-cct-examples-including-political-control" class="level2" data-number="8.5">
<h2 data-number="8.5" data-anchor-id="spatial-econometrics-models-pre-cct-examples-including-political-control"><span class="header-section-number">8.5</span> Spatial econometrics models: pre-CCT examples including political control</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>SEM_pre_maj <span class="ot">&lt;-</span> <span class="fu">errorsarlm</span>(form_pre_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig=</span>e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Hausman.test</span>(SEM_pre_maj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spatial Hausman test (asymptotic)

data:  NULL
Hausman test = 24.487, df = 9, p-value = 0.003594</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>GNM_pre_maj <span class="ot">&lt;-</span> <span class="fu">sacsarlm</span>(form_pre_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">Durbin=</span><span class="fu">update</span>(form_pre_maj, <span class="sc">~</span> . <span class="sc">-</span> Metrop <span class="sc">-</span> Majority), <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig1=</span>e, <span class="at">pre_eig2=</span>e))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>SAC_pre_maj <span class="ot">&lt;-</span> <span class="fu">sacsarlm</span>(form_pre_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig1=</span>e, <span class="at">pre_eig2=</span>e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>SDEM_pre_maj <span class="ot">&lt;-</span> <span class="fu">errorsarlm</span>(form_pre_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">Durbin=</span><span class="fu">update</span>(form_pre_maj, <span class="sc">~</span> . <span class="sc">-</span> Metrop <span class="sc">-</span> Majority), <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig=</span>e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Hausman.test</span>(SDEM_pre_maj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spatial Hausman test (asymptotic)

data:  NULL
Hausman test = 21.775, df = 13, p-value = 0.05894</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>SDM_pre_maj <span class="ot">&lt;-</span> <span class="fu">lagsarlm</span>(form_pre_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">Durbin=</span><span class="fu">update</span>(form_pre_maj, <span class="sc">~</span> . <span class="sc">-</span> Metrop <span class="sc">-</span> Majority), <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig=</span>e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">LM_test=</span><span class="fu">signif</span>(SDM_pre_maj<span class="sc">$</span>LMtest), <span class="at">p.value=</span><span class="fu">format.pval</span>((<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(SDM_pre_maj<span class="sc">$</span>LMtest, <span class="dv">1</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     LM_test      p.value 
   "15.7135" "7.3694e-05" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>SLM_pre_maj <span class="ot">&lt;-</span> <span class="fu">lagsarlm</span>(form_pre_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig=</span>e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">LM_test=</span><span class="fu">signif</span>(SLM_pre_maj<span class="sc">$</span>LMtest), <span class="at">p.value=</span><span class="fu">format.pval</span>((<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(SLM_pre_maj<span class="sc">$</span>LMtest, <span class="dv">1</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  LM_test   p.value 
"1.03321" "0.30941" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>SLX_pre_maj <span class="ot">&lt;-</span> <span class="fu">lmSLX</span>(form_pre_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">Durbin=</span><span class="fu">update</span>(form_pre_maj, <span class="sc">~</span> . <span class="sc">-</span> Metrop <span class="sc">-</span> Majority))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>OLS_pre_maj <span class="ot">&lt;-</span> <span class="fu">lm</span>(form_pre_maj, <span class="at">data=</span>eng324)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>mlist_pre_maj <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">GNM=</span>GNM_pre_maj, <span class="at">SAC=</span>SAC_pre_maj, <span class="at">SDEM=</span>SDEM_pre_maj, <span class="at">SDM=</span>SDM_pre_maj, <span class="at">SLX=</span>SLX_pre_maj, <span class="at">SEM=</span>SEM_pre_maj, <span class="at">SLM=</span>SLM_pre_maj, <span class="at">OLS=</span>OLS_pre_maj)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">length</span>(mlist_pre_maj)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>LR_pre_maj <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">ncol=</span>m, <span class="at">nrow=</span>m)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(LR_pre_maj) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(LR_pre_maj) <span class="ot">&lt;-</span> <span class="fu">names</span>(mlist_pre_maj)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>m) LR_pre_maj[<span class="dv">1</span>, j] <span class="ot">&lt;-</span> <span class="fu">lrtest</span>(mlist_pre_maj[[<span class="dv">1</span>]],</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    mlist_pre_maj[[j]])[[<span class="dv">2</span>, <span class="st">"Pr(&gt;Chisq)"</span>]]</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>) LR_pre_maj[<span class="dv">2</span>, j] <span class="ot">&lt;-</span> <span class="fu">lrtest</span>(mlist_pre_maj[[<span class="dv">2</span>]],</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    mlist_pre_maj[[j]])[[<span class="dv">2</span>, <span class="st">"Pr(&gt;Chisq)"</span>]]</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">8</span>)) LR_pre_maj[<span class="dv">3</span>, j] <span class="ot">&lt;-</span> <span class="fu">lrtest</span>(mlist_pre_maj[[<span class="dv">3</span>]],</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    mlist_pre_maj[[j]])[[<span class="dv">2</span>, <span class="st">"Pr(&gt;Chisq)"</span>]]</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>)) LR_pre_maj[<span class="dv">4</span>, j] <span class="ot">&lt;-</span> <span class="fu">lrtest</span>(mlist_pre_maj[[<span class="dv">4</span>]],</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>    mlist_pre_maj[[j]])[[<span class="dv">2</span>, <span class="st">"Pr(&gt;Chisq)"</span>]]</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>) LR_pre_maj[i, <span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="fu">lrtest</span>(mlist_pre_maj[[i]],</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>    mlist_pre_maj[[<span class="dv">8</span>]])[[<span class="dv">2</span>, <span class="st">"Pr(&gt;Chisq)"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="fl">3.1</span>, <span class="fl">3.1</span>, <span class="fl">3.1</span>, <span class="fl">7.1</span>), <span class="at">cex.axis=</span><span class="fl">0.8</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(LR_pre_maj, <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span><span class="sc">^-</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">0</span>)), <span class="at">col=</span>viridis, <span class="at">las=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="08_talk_files/figure-html/LR3_pre_maj-1.png" style="width:75.0%" class="figure-img"></p>
<figcaption>Heat map of likelihood ratio p-values, pre_CCT models including politiacl control</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">sapply</span>(mlist_pre_maj, AIC))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      GNM       SDM      SDEM       SLX       SLM       SAC       SEM       OLS 
-38.29440 -29.30102 -23.60534 -21.31938 -20.13818 -19.52201 -18.43801 -11.04604 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">sapply</span>(mlist_pre_maj, BIC))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     SLM      GNM      SEM      SAC      OLS      SDM      SLX     SDEM 
21.45000 22.19749 23.15016 25.84692 26.76140 27.41013 31.61103 33.10581 </code></pre>
</div>
</div>
</section>
<section id="spatial-econometrics-models-post-cct-examples-including-political-control" class="level2" data-number="8.6">
<h2 data-number="8.6" data-anchor-id="spatial-econometrics-models-post-cct-examples-including-political-control"><span class="header-section-number">8.6</span> Spatial econometrics models: post-CCT examples including political control</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>SEM_post_maj <span class="ot">&lt;-</span> <span class="fu">errorsarlm</span>(form_post_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig=</span>e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Hausman.test</span>(SEM_post_maj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spatial Hausman test (asymptotic)

data:  NULL
Hausman test = 21.981, df = 9, p-value = 0.008938</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>GNM_post_maj <span class="ot">&lt;-</span> <span class="fu">sacsarlm</span>(form_post_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">Durbin=</span><span class="fu">update</span>(form_post_maj, <span class="sc">~</span> . <span class="sc">-</span> Metrop <span class="sc">-</span> Majority), <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig1=</span>e, <span class="at">pre_eig2=</span>e))</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>SAC_post_maj <span class="ot">&lt;-</span> <span class="fu">sacsarlm</span>(form_post_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig1=</span>e, <span class="at">pre_eig2=</span>e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>SDEM_post_maj <span class="ot">&lt;-</span> <span class="fu">errorsarlm</span>(form_post_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">Durbin=</span><span class="fu">update</span>(form_post_maj, <span class="sc">~</span> . <span class="sc">-</span> Metrop <span class="sc">-</span> Majority), <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig=</span>e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Hausman.test</span>(SDEM_post_maj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spatial Hausman test (asymptotic)

data:  NULL
Hausman test = 15.783, df = 13, p-value = 0.261</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>SDM_post_maj <span class="ot">&lt;-</span> <span class="fu">lagsarlm</span>(form_post_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">Durbin=</span><span class="fu">update</span>(form_post_maj, <span class="sc">~</span> . <span class="sc">-</span> Metrop <span class="sc">-</span> Majority), <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig=</span>e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">LM_test=</span><span class="fu">signif</span>(SDM_post_maj<span class="sc">$</span>LMtest), <span class="at">p.value=</span><span class="fu">format.pval</span>((<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(SDM_post_maj<span class="sc">$</span>LMtest, <span class="dv">1</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   LM_test    p.value 
 "5.46586" "0.019391" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>SLM_post_maj <span class="ot">&lt;-</span> <span class="fu">lagsarlm</span>(form_post_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">control=</span><span class="fu">list</span>(<span class="at">pre_eig=</span>e))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">LM_test=</span><span class="fu">signif</span>(SLM_post_maj<span class="sc">$</span>LMtest), <span class="at">p.value=</span><span class="fu">format.pval</span>((<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(SLM_post_maj<span class="sc">$</span>LMtest, <span class="dv">1</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  LM_test   p.value 
"1.89042" "0.16916" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>SLX_post_maj <span class="ot">&lt;-</span> <span class="fu">lmSLX</span>(form_post_maj, <span class="at">data=</span>eng324, <span class="at">listw=</span>lw, <span class="at">Durbin=</span><span class="fu">update</span>(form_post_maj, <span class="sc">~</span> . <span class="sc">-</span> Metrop <span class="sc">-</span> Majority))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>OLS_post_maj <span class="ot">&lt;-</span> <span class="fu">lm</span>(form_post_maj, <span class="at">data=</span>eng324)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>mlist_post_maj <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">GNM=</span>GNM_post_maj, <span class="at">SAC=</span>SAC_post_maj, <span class="at">SDEM=</span>SDEM_post_maj, <span class="at">SDM=</span>SDM_post_maj, <span class="at">SLX=</span>SLX_post_maj, <span class="at">SEM=</span>SEM_post_maj, <span class="at">SLM=</span>SLM_post_maj, <span class="at">OLS=</span>OLS_post_maj)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">length</span>(mlist_post_maj)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>LR_post_maj <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">ncol=</span>m, <span class="at">nrow=</span>m)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(LR_post_maj) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(LR_post_maj) <span class="ot">&lt;-</span> <span class="fu">names</span>(mlist_post_maj)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>m) LR_post_maj[<span class="dv">1</span>, j] <span class="ot">&lt;-</span> <span class="fu">lrtest</span>(mlist_post_maj[[<span class="dv">1</span>]],</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    mlist_post_maj[[j]])[[<span class="dv">2</span>, <span class="st">"Pr(&gt;Chisq)"</span>]]</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>) LR_post_maj[<span class="dv">2</span>, j] <span class="ot">&lt;-</span> <span class="fu">lrtest</span>(mlist_post_maj[[<span class="dv">2</span>]],</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    mlist_post_maj[[j]])[[<span class="dv">2</span>, <span class="st">"Pr(&gt;Chisq)"</span>]]</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">8</span>)) LR_post_maj[<span class="dv">3</span>, j] <span class="ot">&lt;-</span> <span class="fu">lrtest</span>(mlist_post_maj[[<span class="dv">3</span>]],</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>    mlist_post_maj[[j]])[[<span class="dv">2</span>, <span class="st">"Pr(&gt;Chisq)"</span>]]</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>)) LR_post_maj[<span class="dv">4</span>, j] <span class="ot">&lt;-</span> <span class="fu">lrtest</span>(mlist_post_maj[[<span class="dv">4</span>]],</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>    mlist_post_maj[[j]])[[<span class="dv">2</span>, <span class="st">"Pr(&gt;Chisq)"</span>]]</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>) LR_post_maj[i, <span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="fu">lrtest</span>(mlist_post_maj[[i]],</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>    mlist_post_maj[[<span class="dv">8</span>]])[[<span class="dv">2</span>, <span class="st">"Pr(&gt;Chisq)"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="fl">3.1</span>, <span class="fl">3.1</span>, <span class="fl">3.1</span>, <span class="fl">7.1</span>), <span class="at">cex.axis=</span><span class="fl">0.8</span>)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(LR_post_maj, <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span><span class="sc">^-</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">0</span>)), <span class="at">col=</span>viridis, <span class="at">las=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="08_talk_files/figure-html/LR3_post_maj-1.png" style="width:75.0%" class="figure-img"></p>
<figcaption>Heat map of likelihood ratio p-values, post_CCT models including political control</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">sapply</span>(mlist_post_maj, AIC))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      GNM       SDM      SDEM       SLX       SEM       SAC       SLM       OLS 
-65.97796 -63.54597 -59.60015 -56.38760 -54.05232 -53.87685 -53.76302 -48.47510 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">sapply</span>(mlist_post_maj, BIC))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       SEM        SLM        OLS        SAC        SDM        GNM        SLX 
-12.464138 -12.174841 -10.667662  -8.507931  -6.834818  -5.486068  -3.457190 
      SDEM 
 -2.889000 </code></pre>
</div>
</div>
<p>So we might reasonably choose to proceed with SLM including political control, but will have to wait to present coefficient estimates, or rather the marginal effects, because SLM includes <span class="math inline">\rho_{\mathrm{Lag}} {\mathbf W}{\mathbf y}</span>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-alam-ronnegard-shen:2015" class="csl-entry" role="listitem">
Alam, Moudud, Lars Rönnegård, and Xia Shen. 2015. <span>“Fitting Conditional and Simultaneous Autoregressive Spatial Models in Hglm.”</span> <em>The <span>R</span> Journal</em> 7 (2): 5–18. <a href="https://doi.org/10.32614/RJ-2015-017">https://doi.org/10.32614/RJ-2015-017</a>.
</div>
<div id="ref-anselin:88a" class="csl-entry" role="listitem">
Anselin, Luc. 1988. <span>“Lagrange Multiplier Test Diagnostics for Spatial Dependence and Spatial Heterogeneity.”</span> <em>Geographical Analysis</em> 20 (1): 1–17. <a href="https://doi.org/10.1111/j.1538-4632.1988.tb00159.x">https://doi.org/10.1111/j.1538-4632.1988.tb00159.x</a>.
</div>
<div id="ref-besag:74" class="csl-entry" role="listitem">
Besag, Julian. 1974. <span>“Spatial Interaction and the Statistical Analysis of Lattice Systems.”</span> <em>Journal of the Royal Statistical Society. Series B (Methodological)</em> 36: pp. 192–236.
</div>
<div id="ref-bivandetal:17" class="csl-entry" role="listitem">
Bivand, Roger, Zhe Sha, Liv Osland, and Ingrid Sandvig Thorsen. 2017. <span>“A Comparison of Estimation Methods for Multilevel Models of Spatially Structured Data.”</span> <em>Spatial Statistics</em>. <a href="https://doi.org/10.1016/j.spasta.2017.01.002">https://doi.org/10.1016/j.spasta.2017.01.002</a>.
</div>
<div id="ref-cressie:93" class="csl-entry" role="listitem">
Cressie, Noel A. C. 1993. <em>Statistics for Spatial Data</em>. New York: John Wiley &amp; Sons.
</div>
<div id="ref-gaetan+guyon:10" class="csl-entry" role="listitem">
Gaetan, Carlo, and Xavier Guyon. 2010. <em>Spatial Statistics and Modeling</em>. New York: Springer.
</div>
<div id="ref-JSSv063c01" class="csl-entry" role="listitem">
Gerber, Florian, and Reinhard Furrer. 2015. <span>“Pitfalls in the Implementation of Bayesian Hierarchical Modeling of Areal Count Data: An Illustration Using BYM and Leroux Models.”</span> <em>Journal of Statistical Software, Code Snippets</em> 63 (1): 1–32. <a href="https://doi.org/10.18637/jss.v063.c01">https://doi.org/10.18637/jss.v063.c01</a>.
</div>
<div id="ref-vgr_clubuc3m:19" class="csl-entry" role="listitem">
Gómez-Rubio, Virgilio. 2019. <span>“Spatial Data Analysis with INLA. Coding Club UC3M Tutorial Series. Universidad Carlos III de Madrid.”</span> <a href="https://codingclubuc3m.rbind.io/talk/2019-11-05/">https://codingclubuc3m.rbind.io/talk/2019-11-05/</a>.
</div>
<div id="ref-gómez2020bayesian" class="csl-entry" role="listitem">
———. 2020. <em>Bayesian Inference with INLA</em>. Boca Raton, FL: CRC Press.
</div>
<div id="ref-hepple:76" class="csl-entry" role="listitem">
Hepple, Leslie W. 1976. <span>“A Maximum Likelihood Model for Econometric Estimation with Spatial Series.”</span> In <em>Theory and Practice in Regional Science</em>, edited by I. Masser, 90–104. London Papers in Regional Science. London: Pion.
</div>
<div id="ref-vanlieshout:19" class="csl-entry" role="listitem">
Lieshout, M. N. M. van. 2019. <em>Theory of Spatial Statistics</em>. Boca Raton, FL: Chapman &amp; Hall/CRC.
</div>
<div id="ref-mcculloch+searle:2001" class="csl-entry" role="listitem">
McCulloch, Charles E., and Shayle R. Searle. 2001. <em>Generalized, Linear, and Mixed Models</em>. New York: Wiley.
</div>
<div id="ref-ord:75" class="csl-entry" role="listitem">
Ord, J. Keith. 1975. <span>“Estimation Methods for Models of Spatial Interaction.”</span> <em>Journal of the American Statistical Association</em> 70: 120–26.
</div>
<div id="ref-pace+lesage:08" class="csl-entry" role="listitem">
Pace, R. Kelley, and James P. LeSage. 2008. <span>“A Spatial <span>H</span>ausman Test.”</span> <em>Economics Letters</em> 101: 282–84. <a href="https://doi.org/10.1016/j.econlet.2008.09.003">https://doi.org/10.1016/j.econlet.2008.09.003</a>.
</div>
<div id="ref-pebesma+bivand:23" class="csl-entry" role="listitem">
Pebesma, Edzer, and Roger Bivand. 2023. <em>Spatial Data Science with Applications in <span>R</span></em>. Boca Raton, FL: CRC Press.
</div>
<div id="ref-R:Pinheiro+Bates:2000" class="csl-entry" role="listitem">
Pinheiro, Jose C., and Douglas M. Bates. 2000. <em>Mixed-Effects Models in <span>S</span> and <span>S-Plus</span></em>. New York: Springer.
</div>
<div id="ref-ripley:81" class="csl-entry" role="listitem">
Ripley, Brian D. 1981. <em>Spatial Statistics</em>. New York: John Wiley &amp; Sons.
</div>
<div id="ref-ripley:88" class="csl-entry" role="listitem">
———. 1988. <em>Statistical Inference for Spatial Processes</em>. Cambridge: Cambridge University Press.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./07_talk.html" class="pagination-link" aria-label="Tests of spatial autocorrelation, model specification">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Tests of spatial autocorrelation, model specification</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./09_talk.html" class="pagination-link" aria-label="Estimation of spatial autoregressive models: methods (ML, Bayesian, GMM)">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Estimation of spatial autoregressive models: methods (ML, Bayesian, GMM)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>